name: 'CI Result Slack Notification'

on:
  workflow_call:
    inputs:
      bot_token:
        description: 'Slack Bot Token (xoxb-...)'
        required: false
        type: string
      channel_id:
        description: 'Slack Channel ID (C...)'
        required: false
        type: string
      status:
        description: 'CI結果 (success/failure/cancelled)'
        required: true
        type: string
      project_name:
        description: 'プロジェクト名'
        required: true
        type: string
      action_url:
        description: '実行アクションのURL'
        required: false
        type: string
        default: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
      commit_message:
        description: 'コミットメッセージ'
        required: false
        type: string
        default: ${{ github.event.pull_request.title }}
      author:
        description: 'PR作成者'
        required: false
        type: string
        default: ${{ github.event.pull_request.user.login }}
      github_token:
        description: 'GitHub token for API access'
        required: false
        type: string

jobs:
  notify:
    runs-on: ubuntu-latest
    env:
      GITHUB_TOKEN: ${{ inputs.github_token || github.token }}
    steps:
      - name: Checkout slack-integration
        uses: actions/checkout@v4
        with:
          repository: ${{ github.repository_owner }}/slack-integration
          path: slack-integration

      - name: Send CI result notification
        uses: ./slack-integration/.github/actions/slack-notify
        with:
          bot_token: ${{ inputs.bot_token }}
          channel_id: ${{ inputs.channel_id }}
          user_id: ${{ inputs.author }}
          project_name: ${{ inputs.project_name }}
          pr_title: ${{ inputs.commit_message }}
          pr_url: ${{ github.event.pull_request.html_url }}
          workflow_action: 'CI検証'
          action_url: ${{ inputs.action_url }}
          message: 'CI結果をお知らせします'
          status: ${{ inputs.status }}